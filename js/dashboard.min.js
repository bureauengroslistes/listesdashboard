var STORES={"139":"Drummondville","220":"Sorel","245":"Boucherville"};var SHEET_URL="https://docs.google.com/spreadsheets/d/1CAAR3P6PM2NwHPlyeDfRNQshZyaH8X2mw4ZwxJ_r1CU/pubhtml?gid=1745505354";var PSK="a61711e96496bcfce1c2931ec5c2cbe7";var topBanner=function(a){a=a||false;return m("div.row"+(a?".text-center":""),m("div.col-sm-12",[m("img"+(a?".jfdlogo":".jfdlogotop"),{src:"/img/logojfdtr.png"}),m("h2.apptitle","Tableau de bord des listes scolaires par Jean-François Desrochers"),m("p","Consultez ici toutes les commandes de préparation de listes scolaires pour votre magasin.")]))};function showLoading(a,c,b){if(a){document.getElementById("loadtitle").textContent=c;document.getElementById("loadmessage").textContent=b;document.getElementById("loadscreen").classList.add("show")}else{document.getElementById("loadscreen").classList.remove("show")}}function loadingDone(d,b,a){document.getElementById("loadtitle").textContent=d;document.getElementById("loadmessage").textContent=b;var c=document.getElementById("loadscreen");c.classList.add("done");a=a||false;setTimeout(function(){c.classList.remove("show");c.classList.remove("done");if(a){m.redraw()}},2000)}var Dashdata=function(){var a={};a.answers=m.prop({});a.error=m.prop("");a.loadData=function(b){showLoading(true,"Chargement des données...","Le chargement de vos données est en cours, merci de patienter...");a.error("");a.answers({});sheetrock({url:SHEET_URL,query:"select A,B,C,D,E,F,G,H,I,J,K where B = '"+b+"' order by A desc",reset:true,callback:function(e,d,c){if(!e){m.startComputation();a.answers(c.rows);m.endComputation();showLoading(false)}else{m.startComputation();a.error("Une erreur est survenue lors de la récupération des données. ("+e+") Veuillez contacter le développeur.");m.endComputation();showLoading(false)}}})};return a};var Dashapp={controller:function(b){var a={};a.data=b;a.store=m.route.param("store");a.key=m.route.param("key");a.frontpage=m.prop(true);a.storeEntry=m.prop("");a.passEntry=m.prop("");a.answerIndex=m.prop(-1);a.loadStore=function(){m.route("/"+a.storeEntry()+"/"+md5(a.passEntry()))};a.reloadData=function(){b.loadData(STORES[a.store])};a.storeKeyUp=function(c){if(c.keyCode==13){m.route("/"+a.storeEntry()+"/"+md5(a.passEntry()))}};a.printRow=function(c){a.answerIndex(c);m.redraw();window.print()};if(a.store&&a.store in STORES&&a.key==PSK){a.frontpage(false);b.loadData(STORES[a.store])}return a},view:function(b){var a=b.frontpage();return m("div.container-fluid",[m("div",{className:"noprint"},m("div"+(a?".row":""),m("div"+(a?".col-sm-6.col-sm-offset-3.col-md-4.col-md-offset-4":""),[topBanner(a),a?m("div.jumbotron.row",[m("div.col-sm-8.col-sm-offset-2.text-center",[m("div.lead","Numéro de magasin :"),m("input.form-control",{type:"text",onchange:m.withAttr("value",b.storeEntry),onkeyup:b.storeKeyUp}),m("div.lead.space-before","Mot de passe :"),m("input.form-control",{type:"password",onchange:m.withAttr("value",b.passEntry),onkeyup:b.storeKeyUp}),m("button.btn.btn-primary.btn-lg.space-before",{onclick:b.loadStore},"Charger les données...")])]):m("div.space-before",[m("button.btn.btn-primary",{onclick:b.reloadData},"Rafraîchir les données..."),m("table.table.table-bordered.table-striped.space-before",[m("thead",m("tr",[m("th","Magasin"),m("th","Date et heure de soumission"),m("th","Nom du client"),m("th","Téléphone du client"),m("th","Courriel du client"),m("th","Nom de l'enfant"),m("th","Garçon ou fille"),m("th","Nom de l'école"),m("th","Niveau de la classe"),m("th","Nom de la classe"),m("th","Numéro de l'étiquette"),m("th")])),m("tbody",b.data.error()?m("td.text-danger",b.data.error()):(b.data.answers().length>1)?b.data.answers().filter(function(d,c){return c!=0}).map(function(c){return m("tr",[m("td",c.cells.storecity),m("td",c.cells.datetime),m("td",c.cells.custname),m("td",c.cells.custphone),m("td",c.cells.custemail),m("td",c.cells.childname),m("td",c.cells.childgender),m("td",c.cells.schoolname),m("td",c.cells.schoolclass),m("td",c.cells.schoolgroup),m("td",c.cells.labelno),m("td",m("button.btn.btn-success.btn-xs",{onclick:b.printRow.bind(null,b.data.answers().indexOf(c))},"Imprimer..."))])}):m("td.text-warning","Aucune donnée n'a été trouvée."))])])]))),a?"":m("div.onlyprint",(b.answerIndex()>-1)&&(b.data.answers())?[m("h3","Liste à préparer"),m("h4","Client"),m("p",[b.data.answers()[b.answerIndex()].cells.custname,m("br"),b.data.answers()[b.answerIndex()].cells.custphone,m("br"),b.data.answers()[b.answerIndex()].cells.custemail]),m("h4","Enfant"),m("p",[b.data.answers()[b.answerIndex()].cells.childname,m("br"),b.data.answers()[b.answerIndex()].cells.childgender,m("br"),"Étiquette #"+b.data.answers()[b.answerIndex()].cells.labelno]),m("h4","École"),m("p",[b.data.answers()[b.answerIndex()].cells.schoolname,m("br"),b.data.answers()[b.answerIndex()].cells.schoolclass,m("br"),b.data.answers()[b.answerIndex()].cells.schoolgroup])]:m("h2","Aucunes données à imprimer."))])}};